<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Notio — Session Planner</title>
<style>
  :root{--ink:#111;--muted:#666;--line:#d9d9d9;--box:#f7f7f7;--green:#E0F3E4}
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:#fff;color:var(--ink);font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* Top bars */
  .toolbar{position:sticky;top:0;z-index:20;display:flex;gap:10px;align-items:center;padding:10px 14px;border-bottom:1px solid var(--line);background:#fff}
  .toolbar h1{font-size:16px;margin:0}
  .sp{flex:1}

  /* Global draw toolbar */
  .drawbar{position:sticky;top:52px;z-index:19;background:#fff;border-bottom:1px solid var(--line);padding:8px 14px;display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .badge{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:8px;font-size:12px;color:#555}
  button{appearance:none;background:#fff;border:1px solid var(--line);padding:7px 10px;border-radius:10px;cursor:pointer}
  button.small{padding:6px 8px;border-radius:8px;font-size:12px}
  button.primary{background:#111;color:#fff;border-color:#111}
  button.active{outline:2px solid #111}
  .chip{font-size:12px;color:#555}
  .icon{display:inline-block;width:14px;height:14px;border-radius:50%;vertical-align:-2px;margin-right:4px}
  .icon.blue{background:#3b82f6}.icon.red{background:#ef4444}.icon.orange{background:#f59e0b}
  .icon.ball{background:radial-gradient(circle at 50% 50%, #fff 40%, #111 41%)}

  /* Page and cards */
  .page{max-width:1100px;margin:0 auto;padding:16px;display:grid;gap:14px}
  .card{border:1px solid var(--line);border-radius:16px;padding:12px}
  .title{font-weight:600;color:#444;margin:0 0 8px 0;font-size:13px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .row-30-70{grid-template-columns:30% 70%}
  label .lab{display:block;color:#666;font-size:12px;margin-bottom:4px}
  input[type=text], textarea{width:100%;border:1px solid var(--line);border-radius:8px;padding:8px 10px;background:#fff}
  textarea{min-height:64px;resize:vertical}

  /* Summary */
  .summary{border:1px solid var(--line);border-radius:10px;overflow:hidden;background:var(--box)}
  .summary .hdr, .summary .r{display:grid;grid-template-columns:20% 20% 60%}
  .summary .hdr{font-size:12px;font-weight:600;color:#666;border-bottom:1px solid var(--line)}
  .summary .hdr>div, .summary .r>div{padding:6px 8px;border-left:1px solid var(--line)}
  .summary .hdr>div:first-child, .summary .r>div:first-child{border-left:0}

  /* Drills */
  .drill{border:1px solid var(--line);border-radius:12px;padding:12px}
  .drill .hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
  .two-col{display:grid;grid-template-columns:56% 44%;gap:12px}

  /* Pitch + drawing */
  .pitch{position:relative;background:var(--green);border:1px solid #aaa;border-radius:12px;aspect-ratio:13/10;width:100%;overflow:hidden}
  .pitch svg{width:100%;height:100%;display:block}
  .draw-layer,.grid-layer{position:absolute;inset:0}
  .grid-layer{pointer-events:none}
  .active-pitch{outline:3px solid #111; outline-offset:3px}

  .mini-lab{font-weight:600;color:#555;font-size:12px;margin:8px 0 4px}
  .notes{border:1px solid var(--line);border-radius:10px;height:120px}
  .footer{color:#999;font-size:11px;text-align:right;margin-top:6px}

  @media print{
    .toolbar,.drawbar{display:none}
    .page{padding:0}
    input,textarea{border:none !important}
    @page{size:A4 portrait;margin:10mm}
  }
</style>
</head>
<body>

  <!-- Top toolbar -->
  <div class="toolbar">
    <h1>Notio — Session Planner</h1>
    <div class="sp"></div>
    <button id="btnPrint" class="primary">Print / Export PDF</button>
  </div>

  <!-- Global drawing toolbar (one tool for ALL pitches) -->
  <div class="drawbar" id="drawbar">
    <span class="badge">Tools</span>
    <button class="small" data-tool="pen">Pen</button>
    <button class="small" data-tool="eraser">Eraser</button>
    <button class="small" data-tool="arrow">Arrow</button>

    <span class="badge">Stamps</span>
    <button class="small" data-tool="playerA"><span class="icon blue"></span>A</button>
    <button class="small" data-tool="playerB"><span class="icon red"></span>B</button>
    <button class="small" data-tool="cone"><span class="icon orange"></span>Cone</button>
    <button class="small" data-tool="ball"><span class="icon ball"></span>Ball</button>

    <span class="badge">Actions</span>
    <button class="small" data-act="undo">Undo</button>
    <button class="small" data-act="redo">Redo</button>
    <button class="small" data-act="clear">Clear</button>
    <button class="small" data-act="grid">Grid</button>

    <span class="sp"></span>
    <span class="chip" id="activeChip">Editing: Drill 1</span>
  </div>

  <div class="page" id="app">

    <!-- Header -->
    <div class="card">
      <div class="title">Session Header</div>
      <div class="row">
        <label><span class="lab">Session Title</span><input type="text" id="title"></label>
        <label><span class="lab">Age Group</span><input type="text" id="ageGroup"></label>
      </div>
      <div class="row row-30-70" style="margin-top:8px">
        <label><span class="lab">Players</span><input type="text" id="players"></label>
        <label><span class="lab">Objective</span><input type="text" id="objective"></label>
        <label><span class="lab">Area needed</span><input type="text" id="area"></label>
        <label><span class="lab">Equipment</span><input type="text" id="equipment"></label>
      </div>
    </div>

    <!-- Overview -->
    <div class="card">
      <div class="title">Drill Overview (editable)</div>
      <div class="summary" id="overview">
        <div class="hdr"><div>Drill</div><div>Duration</div><div>Purpose / Notes</div></div>
        <!-- rows injected -->
      </div>
    </div>

    <!-- Drills -->
    <div id="drills"></div>

    <!-- Notes -->
    <div class="card">
      <div class="title">Coach Notes / Reflection</div>
      <div class="notes"></div>
      <div class="footer">Template by Alex Hammond-Cole | Notio (Web)</div>
    </div>
  </div>

<script>
(function(){
  const $ = (s,root=document)=>root.querySelector(s);
  const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));

  // ---- Data ----
  const defaultDrills = [
    { name:"Passing Practice",   duration:"~10 min",    purpose:"Warm up & intro of session focus", setup:"", exercise:"", progression:"" },
    { name:"Positioning Game",   duration:"~10–15 min", purpose:"Posession Game",                    setup:"", exercise:"", progression:"" },
    { name:"Game Training",      duration:"~20–25 min", purpose:"Realistic match situation",         setup:"", exercise:"", progression:"" },
    { name:"Training Game",      duration:"~20–25 min", purpose:"Game",                               setup:"", exercise:"", progression:"" }
  ];

  const state = {
    title:"", ageGroup:"", players:"", objective:"", area:"", equipment:"",
    drills: JSON.parse(JSON.stringify(defaultDrills)),
    drawings: [],      // per-drill {actions:[], redo:[], grid:false}
    active: 0,         // active drill index for drawing
    tool: 'pen'
  };
  state.drawings = state.drills.map(()=>({actions:[],redo:[],grid:false}));

  // ---- UI: header + overview ----
  ["title","ageGroup","players","objective","area","equipment"].forEach(id=>{
    $("#"+id).addEventListener("input", e=>{ state[id]=e.target.value; });
  });

  const overview = $("#overview");
  function renderOverview(){
    $$(".r", overview).forEach(n=>n.remove());
    state.drills.forEach((d,i)=>{
      const row = document.createElement("div");
      row.className = "r";
      row.innerHTML = `
        <div><input type="text" value="${esc(d.name)}" data-i="${i}" data-k="name"></div>
        <div><input type="text" value="${esc(d.duration)}" data-i="${i}" data-k="duration"></div>
        <div><input type="text" value="${esc(d.purpose)}" data-i="${i}" data-k="purpose"></div>
      `;
      overview.appendChild(row);
    });
    $$("input", overview).forEach(inp=>{
      inp.addEventListener("input", e=>{
        const i=+e.target.dataset.i, k=e.target.dataset.k;
        state.drills[i][k]=e.target.value;
        // also reflect name into drill header immediately
        const hdr = $(`.drill[data-i="${i}"] .name`);
        if(hdr && k==="name") hdr.textContent = e.target.value || `Drill ${i+1}`;
      });
    });
  }

  // ---- Global draw toolbar ----
  const drawbar = $("#drawbar");
  function setActiveTool(tool){
    state.tool = tool;
    $$("button[data-tool]", drawbar).forEach(b=>b.classList.toggle("active", b.dataset.tool===tool));
  }
  setActiveTool('pen');
  drawbar.addEventListener("click", e=>{
    const btn = e.target.closest("button");
    if(!btn) return;
    const tool = btn.dataset.tool;
    const act  = btn.dataset.act;
    if(tool){ setActiveTool(tool); return; }

    const D = state.drawings[state.active];
    if(act==="undo"){
      if(D.actions.length){ D.redo.push(D.actions.pop()); renderCanvas(state.active); }
    } else if(act==="redo"){
      if(D.redo.length){ D.actions.push(D.redo.pop()); renderCanvas(state.active); }
    } else if(act==="clear"){
      D.actions = []; D.redo = []; renderCanvas(state.active);
    } else if(act==="grid"){
      D.grid = !D.grid; renderCanvas(state.active);
    }
  });

  // ---- Drills list ----
  const drillsRoot = $("#drills");
  function renderDrills(){
    drillsRoot.innerHTML = "";
    state.drills.forEach((d,i)=>{
      const card = document.createElement("div");
      card.className = "card drill";
      card.dataset.i = i;
      card.innerHTML = `
        <div class="hdr"><div class="name">${esc(d.name) || `Drill ${i+1}`}</div></div>
        <div class="two-col">
          <div>
            <div class="mini-lab">Setup</div>
            <textarea data-i="${i}" data-k="setup">${esc(d.setup)}</textarea>
            <div class="mini-lab">Exercise</div>
            <textarea data-i="${i}" data-k="exercise">${esc(d.exercise)}</textarea>
            <div class="mini-lab">Progression</div>
            <textarea data-i="${i}" data-k="progression">${esc(d.progression)}</textarea>
          </div>
          <div>
            <div class="pitch" data-i="${i}" tabindex="0">
              <svg viewBox="0 0 1000 650">
                <rect x="10" y="10" width="980" height="630" fill="none" stroke="#AAAAAA" stroke-width="3"/>
                <line x1="20" y1="40" x2="980" y2="40" stroke="#BBBBBB" stroke-width="2"/>
                <rect x="160" y="300" width="680" height="260" fill="none" stroke="#AAAAAA" stroke-width="2"/>
                <rect x="260" y="410" width="480" height="150" fill="none" stroke="#AAAAAA" stroke-width="2"/>
                <circle cx="500" cy="360" r="6" fill="#AAAAAA"/>
              </svg>
              <canvas class="draw-layer"></canvas>
              <canvas class="grid-layer"></canvas>
            </div>
          </div>
        </div>
      `;
      drillsRoot.appendChild(card);

      // text bindings
      $$("textarea", card).forEach(t=>{
        t.addEventListener("input", e=>{
          const i2=+e.target.dataset.i, k=e.target.dataset.k;
          state.drills[i2][k]=e.target.value;
        });
      });

      // canvas setup
      const pitch = card.querySelector(".pitch");
      setupCanvas(pitch, i);
      if(i===state.active) pitch.classList.add("active-pitch");
      pitch.addEventListener("click", ()=>setActivePitch(i));
    });
    updateActiveChip();
  }

  function setActivePitch(i){
    state.active = i;
    $$(".pitch").forEach(p=>p.classList.remove("active-pitch"));
    const pitch = $(`.pitch[data-i="${i}"]`);
    if(pitch) pitch.classList.add("active-pitch");
    updateActiveChip();
  }
  function updateActiveChip(){
    $("#activeChip").textContent = `Editing: Drill ${state.active+1}`;
  }

  // ---- Canvas drawing engine (global toolbar drives it) ----
  function setupCanvas(pitch, i){
    const layer = pitch.querySelector(".draw-layer");
    const gridL = pitch.querySelector(".grid-layer");
    function resize(){
      const r = pitch.getBoundingClientRect();
      [layer, gridL].forEach(c=>{ c.width=r.width; c.height=r.height; });
      renderCanvas(i);
    }
    new ResizeObserver(resize).observe(pitch);
    resize();

    let drawing=false, cur=null;

    function pos(e){
      const r=layer.getBoundingClientRect();
      const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left;
      const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top;
      return {x,y};
    }

    function down(e){
      e.preventDefault();
      setActivePitch(i); // select this canvas
      const tool = state.tool;
      const D = state.drawings[i];
      D.redo = []; // break redo chain on new action
      const p = pos(e);
      if(tool==='pen'){
        drawing=true; cur={type:'path', color:'#111', w:3, pts:[p]}; D.actions.push(cur);
      } else if(tool==='eraser'){
        drawing=true; cur={type:'path', color:'#fff', w:16, pts:[p]}; D.actions.push(cur);
      } else if(tool==='arrow'){
        drawing=true; cur={type:'arrow', color:'#111', w:3, x1:p.x, y1:p.y, x2:p.x, y2:p.y}; D.actions.push(cur);
      } else { // stamps
        D.actions.push({type:'stamp', kind:tool, x:p.x, y:p.y});
      }
      renderCanvas(i);
    }
    function move(e){
      if(!drawing) return;
      const p = pos(e);
      if(cur.type==='path'){ cur.pts.push(p); }
      else if(cur.type==='arrow'){ cur.x2=p.x; cur.y2=p.y; }
      renderCanvas(i);
    }
    function up(){ drawing=false; cur=null; }

    layer.addEventListener("mousedown", down);
    layer.addEventListener("mousemove", move);
    window.addEventListener("mouseup", up);
    layer.addEventListener("touchstart", down, {passive:false});
    layer.addEventListener("touchmove", move, {passive:false});
    layer.addEventListener("touchend", up);
  }

  function renderCanvas(i){
    const pitch = $(`.pitch[data-i="${i}"]`);
    if(!pitch) return;
    const layer = pitch.querySelector(".draw-layer");
    const grid  = pitch.querySelector(".grid-layer");
    const ctx = layer.getContext("2d");
    const gtx = grid.getContext("2d");
    const D = state.drawings[i];

    // background grid
    gtx.clearRect(0,0,grid.width,grid.height);
    if(D.grid){
      gtx.strokeStyle='#d0e8d4'; gtx.lineWidth=1;
      const step = Math.max(16, Math.min(grid.width,grid.height)/20);
      for(let x=0;x<=grid.width;x+=step){ gtx.beginPath(); gtx.moveTo(x,0); gtx.lineTo(x,grid.height); gtx.stroke(); }
      for(let y=0;y<=grid.height;y+=step){ gtx.beginPath(); gtx.moveTo(0,y); gtx.lineTo(grid.width,y); gtx.stroke(); }
    }

    // draw actions
    ctx.clearRect(0,0,layer.width,layer.height);
    for(const a of D.actions){
      if(a.type==='path'){
        ctx.strokeStyle=a.color; ctx.lineWidth=a.w; ctx.lineCap='round'; ctx.lineJoin='round';
        ctx.beginPath(); a.pts.forEach((p,j)=> j?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y)); ctx.stroke();
      } else if(a.type==='arrow'){
        ctx.strokeStyle=a.color; ctx.lineWidth=a.w;
        ctx.beginPath(); ctx.moveTo(a.x1,a.y1); ctx.lineTo(a.x2,a.y2); ctx.stroke();
        const ang=Math.atan2(a.y2-a.y1,a.x2-a.x1), head=12;
        ctx.beginPath();
        ctx.moveTo(a.x2,a.y2);
        ctx.lineTo(a.x2-head*Math.cos(ang-Math.PI/6), a.y2-head*Math.sin(ang-Math.PI/6));
        ctx.moveTo(a.x2,a.y2);
        ctx.lineTo(a.x2-head*Math.cos(ang+Math.PI/6), a.y2-head*Math.sin(ang+Math.PI/6));
        ctx.stroke();
      } else if(a.type==='stamp'){
        if(a.kind==='playerA'||a.kind==='playerB'){
          ctx.fillStyle=a.kind==='playerA'?'#3b82f6':'#ef4444';
          ctx.beginPath(); ctx.arc(a.x,a.y,10,0,Math.PI*2); ctx.fill();
        } else if(a.kind==='cone'){
          ctx.fillStyle='#f59e0b'; ctx.beginPath();
          ctx.moveTo(a.x,a.y-10); ctx.lineTo(a.x-9,a.y+8); ctx.lineTo(a.x+9,a.y+8); ctx.closePath(); ctx.fill();
        } else if(a.kind==='ball'){
          ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(a.x,a.y,9,0,Math.PI*2); ctx.fill();
          ctx.strokeStyle='#111'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(a.x,a.y,9,0,Math.PI*2); ctx.stroke();
        }
      }
    }
  }

  // ---- Print / Export ----
  $("#btnPrint").addEventListener("click", ()=>window.print());

  // ---- Boot ----
  function renderAll(){
    renderOverview();
    renderDrills();
    // initial render canvases
    state.drills.forEach((_,i)=>renderCanvas(i));
  }
  renderAll();

  // Helpers
  function esc(s){ return String(s??"").replace(/[&<>]/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])); }
})();
</script>
</body>
</html>
